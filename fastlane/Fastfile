default_platform(:ios)

platform :ios do
  desc "커스텀 릴리즈"
  lane :custom_lane do
    # 1) App Store Connect API 키 설정
    api_key = app_store_connect_api_key(
      key_id:       ENV["FASTLANE_APPLE_API_KEY_KEY_ID"],
      issuer_id:    ENV["FASTLANE_APPLE_API_KEY_ISSUER_ID"],
      key_content: ENV["FASTLANE_APPLE_API_KEY_CONTENT"],
      is_key_content_base64: true
    )

    # 2) 이후 액션에 api_key 옵션 전달
    #    예: TestFlight 업로드
    pilot(
      api_key: api_key,
      skip_waiting_for_build_processing: true
    )

    #    예: 메타데이터/스크린샷 배포
    deliver(
      api_key:                   api_key,
      force:                     true,
      skip_screenshots:          false,
      skip_metadata:             false,
      submit_for_review:         true
    )
  end
end